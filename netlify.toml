# netlify.toml - ACTUALIZADO CON CRON Y NUEVAS RUTAS

[build]
  functions = "netlify/functions"

# ✅ NUEVO - CRON JOB para recordatorios diarios a las 10:00 AM Chile
[functions."cron/daily-reminders"]
  schedule = "0 13 * * *"  # 13:00 UTC = 10:00 AM Chile (UTC-3)

# ✅ NUEVAS RUTAS - Confirmación y cancelación de citas
[[redirects]]
  from = "/api/appointments/confirm/:token"
  to = "/.netlify/functions/appointments/confirm-appointment"
  status = 200

[[redirects]]
  from = "/api/appointments/cancel/:token"
  to = "/.netlify/functions/appointments/cancel-appointment"
  status = 200

# ✅ NUEVA RUTA - CRON manual para testing
[[redirects]]
  from = "/api/cron/daily-reminders"
  to = "/.netlify/functions/cron/daily-reminders"
  status = 200

# Rutas existentes para tratamientos
[[redirects]]
  from = "/api/treatments/patient/:patientId"
  to = "/.netlify/functions/treatments"
  status = 200

[[redirects]]
  from = "/api/treatments/:treatmentId"
  to = "/.netlify/functions/treatments"
  status = 200

# Otras rutas existentes...
[[redirects]]
  from = "/api/auth/*"
  to = "/.netlify/functions/auth"
  status = 200

[[redirects]]
  from = "/api/patients/*"
  to = "/.netlify/functions/patients/patients"
  status = 200

[[redirects]]
  from = "/api/user/*"
  to = "/.netlify/functions/user/user"
  status = 200

[[redirects]]
  from = "/api/upload"
  to = "/.netlify/functions/upload"
  status = 200

[[redirects]]
  from = "/api/appointments"
  to = "/.netlify/functions/appointments/appointments"
  status = 200
  methods = ["GET", "POST", "OPTIONS"]

[[redirects]]
  from = "/api/appointments/*"
  to = "/.netlify/functions/appointments/appointments"
  status = 200
  methods = ["GET", "PUT", "DELETE", "OPTIONS"]

[[redirects]]
  from = "/api/appointments/*/status"
  to = "/.netlify/functions/appointments/status"
  status = 200
  methods = ["PUT", "OPTIONS"]

[[redirects]]
  from = "/api/appointments/availability"
  to = "/.netlify/functions/appointments/availability"
  status = 200
  methods = ["GET", "OPTIONS"]

# Ruta por defecto para SPA
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200