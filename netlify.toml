# netlify.toml

[build]
  # Si ya configuras build/publish en la UI, puedes omitir estos dos.
  # Los dejo comentados por si los necesitas.
  # command = "npm run build"
  # publish = "dist"

# ðŸ‘‡ Esta es la forma correcta de declarar el directorio de funciones
[functions]
  directory = "netlify/functions"
  node_bundler = "esbuild"

# ðŸ•’ Scheduled Function (formato recomendado por Netlify)
# path es la RUTA DE ARCHIVO relativa a [functions].directory (sin .ts)
[[scheduled.functions]]
  path = "daily-reminders" 
  schedule = "0 13 * * *"  # 13:00 UTC = 10:00 Chile (UTC-3)

# ----- RUTA BONITA: deja que el SPA (React Router) la maneje -----
[[redirects]]
  from = "/confirm-appointment/:token"
  to = "/index.html"
  status = 200
  force = true

# CONFIRMAR: pasa :token y usa nombre aplanado
[[redirects]]
  from = "/api/appointments/confirm/:token"
  to = "/.netlify/functions/appointments-confirm-appointment/:token"
  status = 200
  force = true  # evita que el SPA capture la ruta

# CANCELAR: idem (aplanado y token)
[[redirects]]
  from = "/api/appointments/cancel/:token"
  to = "/.netlify/functions/appointments-cancel-appointment/:token"
  status = 200
  force = true

[[redirects]]
  from = "/api/treatments/patient/:patientId"
  to = "/.netlify/functions/treatments"
  status = 200

[[redirects]]
  from = "/api/treatments/:treatmentId"
  to = "/.netlify/functions/treatments"
  status = 200

[[redirects]]
  from = "/api/auth/*"
  to = "/.netlify/functions/auth"
  status = 200

[[redirects]]
  from = "/api/patients/*"
  to = "/.netlify/functions/patients/patients"
  status = 200

[[redirects]]
  from = "/api/user/*"
  to = "/.netlify/functions/user/user"
  status = 200

[[redirects]]
  from = "/api/upload"
  to = "/.netlify/functions/upload"
  status = 200

[[redirects]]
  from = "/api/appointments"
  to = "/.netlify/functions/appointments/appointments"
  status = 200
  methods = ["GET", "POST", "OPTIONS"]

[[redirects]]
  from = "/api/appointments/*"
  to = "/.netlify/functions/appointments/appointments"
  status = 200
  methods = ["GET", "PUT", "DELETE", "OPTIONS"]

[[redirects]]
  from = "/api/appointments/*/status"
  to = "/.netlify/functions/appointments/status"
  status = 200
  methods = ["PUT", "OPTIONS"]

[[redirects]]
  from = "/api/appointments/availability"
  to = "/.netlify/functions/appointments/availability"
  status = 200
  methods = ["GET", "OPTIONS"]

# âœ… Protege el namespace de Functions para que el fallback del SPA no lo intercepte
[[redirects]]
  from = "/.netlify/functions/*"
  to = "/.netlify/functions/:splat"
  status = 200

# SPA fallback (dejar al final)
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
